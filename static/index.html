<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soldier Store</title>
<link href="lib/bootstrap-2.2.1/css/bootstrap.min.css" rel="stylesheet">
<link href="css/index.css" rel="stylesheet">
<link href="lib/bootstrap-2.2.1/css/bootstrap-responsive.min.css" rel="stylesheet">
<link href="http://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet" type="text/css">
<script id="soldiers-template" type="text/html">
{{#soldiers}}
  <div class="row-fluid">
    {{#soldiers}}
      <div class="well span4 clearfix" id="{{id}}">
        <img class="photo pull-right" src="img/transparent.gif" />
        <dl>
          <dt>name:</dt>
          <dd class="soldier-name">{{name}}</dd>
          <dt>description:</dt>
          <dd>{{description}}</dd>
        </dl>
        <div class="pull-right">
          <a id="hire-{{id}}" soldier-id="{{id}}" class="btn-hire-soldier btn btn-inverse btn-large">
            <i class="icon-white icon-plus-sign"></i>
            Hire
          </a>
        </div>
      </div>
    {{/soldiers}}
  </div>
{{/soldiers}}
</script>
<script id="hire-soldier-modal-body-template" type="text/html">
{{soldierId}}
</script>
</head>
<body>
  <div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span>
          <span class="icon-bar"></span> <span class="icon-bar"></span>
        </a> <a class="brand" href="#" id="brand">Soldier Store</a>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li class="active"><a href="#">Soldiers</a></li>
            <li><a href="#disclaimer">Disclaimer</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div id="soldiers-container">Loading soldiers...</div>
    <div class="row-fluid" id="disclaimer">
      <h2>Disclaimer</h2>
      <p>Of course, Soldier Store is not intended to recruit real soldiers. This store is to put some salt on the
        too much common pet store. We love peace.</p>
      <p>All characters appearing in this work are fictitious. Any resemblance to real persons, living or dead, is
        purely coincidental.</p>
    </div>
    <hr>
    <footer>
      <p>&copy; Valtech 2012</p>
    </footer>
  </div>
  <div id="hire-soldier-dialog" class="modal hide" tabindex="-1" role="dialog">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">Ã—</button>
      <h3>Hire a Soldier</h3>
    </div>
    <div class="modal-body" id="hire-soldier-modal-body"></div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal">Cancel</button>
      <button id="btn-dialog-hire-soldier" class="btn btn-primary">Hire</button>
    </div>
  </div>
  <script src="lib/jquery-1.8.3/jquery.min.js"></script>
  <script src="lib/bootstrap-2.2.1/js/bootstrap.min.js"></script>
  <script src="lib/mustache.js-0.7.0/mustache.min.js"></script>
  <script>
      var addSoldiers = function() {
        return $.getJSON('data/soldiers.json', function(data) {
          var soldiersTemplate = $('#soldiers-template').html();
          var soldiersHtml = Mustache.render(soldiersTemplate, data);
          $('#soldiers-container').html(soldiersHtml);
        });
      };

      var removeClickListenerFromDialogButton = function() {
        $('#btn-dialog-hire-soldier').off('click');
      };

      var addClickListenerToDialogButton = function(data) {
        $('#btn-dialog-hire-soldier').click(function(event) {
          $('#hire-' + data.soldierId).addClass('disabled').off('click');
          $('#hire-soldier-dialog').modal('hide');
        });
      };

      var addClickListenerToSoldierButtons = function() {
        $('.btn-hire-soldier').click(function(event) {
          var template = $('#hire-soldier-modal-body-template').html();
          var data = {
            'soldierId' : event.target.getAttribute('soldier-id')
          };
          var soldierId = Mustache.render(template, data);
          $('#hire-soldier-modal-body').html(soldierId);
          addClickListenerToDialogButton(data);
          $('#hire-soldier-dialog').modal();
        });
      };

      var addHiddenListenerToDialog = function() {
        $('#hire-soldier-dialog').on('hidden', function() {
          removeClickListenerFromDialogButton();
        });
      }

      $(document).ready(function() {
        addHiddenListenerToDialog();
        addSoldiers().done(addClickListenerToSoldierButtons)
      });
    </script>
</body>
</html>